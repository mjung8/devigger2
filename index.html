<html>

<head>
    <title>Sportsbook Probability Calculator</title>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <script defer src="assets/js/main.js"></script>
</head>

<body>

    <py-config>
        packages = ["numpy", "scipy"]
    </py-config>

    <py-script>
        import js
        import numpy as np

        from pyodide.ffi import create_proxy
        from pyodide.ffi import to_js
        from scipy.optimize import bisect

        def _get_shin_implied_probabilities(z, pi):
            normalization = sum(pi)
            return ((z ** 2 + 4 * (1 - z) * pi ** 2 / normalization) ** 0.5 - z) / (2 - 2 * z)


        def _get_shin_normalization(z, pi):
            implied_probabilities = _get_shin_implied_probabilities(z, pi)
            return 1 - sum(implied_probabilities)


        def _get_power_normalization(k, pi):
            implied_probabilities = pi ** k
            return 1 - sum(implied_probabilities)


        def calculate_multiplicative_probability(args):
            odds = np.array(args.to_py())
            pi = 1 / odds

            normalization = np.sum(pi, axis=1, keepdims=True)
            implied_probabilities = pi / normalization

            return implied_probabilities


        def calculate_additive_probability(args):
            odds = np.array(args.to_py())
            pi = 1 / odds

            implied_probabilities = pi + 1 / odds.shape[1] * (1 - np.sum(pi, axis=1, keepdims=True))

            return implied_probabilities


        def calculate_power_probability(args):
            odds = np.array(args.to_py())
            pi = 1 / odds

            k_opt = bisect(_get_power_normalization, 0, 100, args=(pi))
            implied_probabilities = pi ** k_opt

            return implied_probabilities


        def calculate_shin_probability(args):
            odds = np.array(args.to_py())
            pi = 1 / odds

            z_opt = bisect(_get_shin_normalization, 0, 10, args=(pi))
            implied_probabilities = _get_shin_implied_probabilities(z_opt, pi)

            return implied_probabilities

        
        def american_to_decimal(american_odds):
            if american_odds > 0:
                return (american_odds / 100) + 1
            else:
                return 100 / (-american_odds) + 1

        
        def decimal_to_american(decimal):
            if decimal <= 2:
                return (-100 / (decimal - 1))
            else:
                return (100 * (decimal - 1))

        
        def percent_to_american(percent):
            decimal = 1 / percent
            return decimal_to_american(decimal)


        def calculate_product(percent):
            percentNp = np.array(percent.to_py())
            decimal = 1 / percentNp
            firsts = decimal[:, 0]
            result = np.prod(firsts)
            return result

        def calculate_juice(decimal):
            decimalNp = np.array(decimal.to_py())
            percent = 1 / decimalNp
            juice = np.sum(percent, axis=1)
            return juice

        def v_american_to_decimal(american_odds):
            result = np.vectorize(american_to_decimal)(np.asarray(american_odds.to_py()))
            return result


        def v_decimal_to_american(decimal):
            result = np.vectorize(decimal_to_american)(np.asarray(decimal.to_py()))
            return result


        def v_percent_to_american(percent):
            result = np.vectorize(percent_to_american)(np.asarray(percent.to_py()))
            #result = (np.rint(result)).astype(int)
            return result

    </py-script>
    <main>
        <div class="container-fluid mt-2">
            <h2>Sportsbook Probability Calculator</h2>
            <br />
            <div class="row">
                <div class="col">
                    <label for="bankroll">Bankroll:
                        <input class="form-control form-control-sm" type="number" id="bankroll" name="bankroll" value="1000">
                    </label>
                    <label for="kelly">Kelly:
                        <input class="form-control form-control-sm" type="number" id="kelly" name="kelly" value="0.25">
                    </label>
                </div>
            </div>
    
            <br />
    
            <div>
                <div>
                    <div>
                        <textarea class="form-control form-control-sm" id="gridBuilderTextArea" rows="5" cols="50"></textarea>
                        <label id="helpLabel" title="Click me for help">‚ùî</label>
                    </div>
                    <p id="helpText"style="display:none;"><strong>How to use:</strong><br />
                        Enter the number of sides, separating legs with a comma. Enter each boost on a new line.<br />
                        Ex#1: 3-leg MLB 2-way (NYY/TOR/BAL): 2, 2, 2<br />
                        Ex#2: 3-leg soccer 3-way (Barca/Bayern/Inter): 3, 3, 3<br />
                        Ex#3: 1-leg prop 4-way (): 4<br />
                        Ex#4: 1-leg something 2-way (): 2<br />
                        <br />
                        2, 2, 2<br />
                        3, 3, 3<br />
                        4<br />
                        2<br />
                        <br />
                        Then click the [Build Table] button. A grid of inputs will be created for data entry.<br />
                        Then click any [Calculate] button to display results.
                    </p>
                </div>
            </div>
            
            <div id="buttonHolderDiv">
                <div>
                    <button type="button" id="buildTableButton" class="btn btn-primary btn-sm">Build Table</button>
                </div>
                <br />
                <div>
                    <span>File Loader: select a .json file to load and automatically create the table</span><br />
                    <input class="form-control form-control-sm" type="file" id="fileLoaderInput" /><br />
                </div>
                <br />
                <div>
                    <span>File Saver: enter a file name to save data for later (as .json)</span><br />
                    <input type="text" id="fileNameInput" class="form-control form-control-sm" />
                    <button type="button" id="saveFileButton" class="btn btn-secondary btn-sm">Save File</button>
                </div>
            </div>
        </div>
    
        <br />
        <div id="allContainer">
        </div>
        <br />
        <!--<div id="allContainer2">
            <div class="eventContainer" id="061320231">
                <div>
                    <input type="text" class="userInput fst-italic form-control form-control-sm bookInput">
                    <input type="text" class="userInput fst-italic form-control form-control-sm boostDescription">
                    <div class="text-body-tertiary">170/-187,229/-256,-149/137</div>
                </div>
                <div>
                    <div class="fw-bold mx-2 oddsLabel">Odds</div>
                    <div class="legGrouping">
                        <input type="number" class="userInput form-control form-control-sm">
                        <input type="number" class="userInput form-control form-control-sm">
                    </div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm">
                        <input type="number" class="userInput form-control form-control-sm">
                    </div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm">
                        <input type="number" class="userInput form-control form-control-sm">
                    </div>
                    <div class="finalGrouping">
                        <div class="fw-bold">Final</div>
                        <input type="number" class="userInput form-control form-control-sm">
                    </div>
                    <button class="calculateButton btn btn-primary btn-sm">Calculate</button>
                </div>
                <div class="resultsContainer">
                    <div class="fw-bold mx-2 methodName">Devigged</div>
                    <div class="resultsGrouping">
                        <div class="resultsFVHeading">Fair Value</div>
                        <div class="resultsMJHeading">Juice</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVHeading">Fair Value</div>
                        <div class="resultsMJHeading">Juice</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVHeading">Fair Value</div>
                        <div class="resultsMJHeading">Juice</div>
                    </div>
                    <div class="finalResultsGrouping">
                        <div class="resultsFVHeading">Total Fair Value</div>
                        <div class="resultsMJHeading">Total Juice</div>
                        <div class="resultsEVKWHeading">EV</div>
                        <div class="resultsEVKWHeading">KW</div>
                        <div class="resultsEVKWHeading">Full</div>
                        <div class="resultsEVKWHeading">1/2</div>
                        <div class="resultsEVKWHeading">1/4</div>
                    </div>
                </div>
                <div class="resultsContainer">
                    <div class="fw-bold mx-2 methodName">Multiplicative:</div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+176 (36.2%)</div>
                        <div class="resultsMJText">2.3%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+237 (29.7%)</div>
                        <div class="resultsMJText">2.3%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">-142 (58.6%)</div>
                        <div class="resultsMJText">2.0%</div>
                    </div>
                    <div class="finalResultsGrouping">
                        <div class="resultsFVText">+1484 (6.3%)</div>
                        <div class="resultsTMJText">6.53%</div>
                        <div class="resultsEVKWText">‚ùå-43.8%</div>
                        <div class="resultsEVKWText">$-13.86</div>
                        <div class="resultsEVKWText">-5.54u</div>
                        <div class="resultsEVKWText">-2.77u</div> 
                        <div class="resultsEVKWText">-1.39u</div>
                    </div>
                </div>
                <div class="resultsContainer">
                    <div class="fw-bold mx-2 methodName">Additive:</div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+178 (35.9%)</div>
                        <div class="resultsMJText">2.2%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+242 (29.2%)</div>
                        <div class="resultsMJText">2.3%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">-143 (58.8%)</div>
                        <div class="resultsMJText">2.0%</div>
                    </div>
                    <div class="finalResultsGrouping">
                        <div class="resultsFVText">+1518 (6.2%)</div>
                        <div class="resultsTMJText">6.53%</div>
                        <div class="resultsEVKWText">‚ùå-45.0%</div>
                        <div class="resultsEVKWText">$-14.23</div>
                        <div class="resultsEVKWText">-5.69u</div>
                        <div class="resultsEVKWText">-2.85u</div> 
                        <div class="resultsEVKWText">-1.42u</div>
                    </div>
                </div>
                <div class="resultsContainer">
                    <div class="fw-bold mx-2 methodName">Power:</div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+179 (35.8%)</div>
                        <div class="resultsMJText">2.2%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+245 (29.0%)</div>
                        <div class="resultsMJText">2.3%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">-143 (58.9%)</div>
                        <div class="resultsMJText">2.0%</div>
                    </div>
                    <div class="finalResultsGrouping">
                        <div class="resultsFVText">+1535 (6.1%)</div>
                        <div class="resultsTMJText">6.53%</div>
                        <div class="resultsEVKWText">‚ùå-45.6%</div>
                        <div class="resultsEVKWText">$-14.42</div>
                        <div class="resultsEVKWText">-5.77u</div>
                        <div class="resultsEVKWText">-2.88u</div> 
                        <div class="resultsEVKWText">-1.44u</div>
                    </div>
                </div>
                <div class="resultsContainer">
                    <div class="fw-bold mx-2 methodName">Shin:</div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+178 (35.9%)</div>
                        <div class="resultsMJText">2.2%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">+242 (29.2%)</div>
                        <div class="resultsMJText">2.3%</div>
                    </div>
                    <div class="resultsGrouping">
                        <div class="resultsFVText">-143 (58.8%)</div>
                        <div class="resultsMJText">2.0%</div>
                    </div>
                    <div class="finalResultsGrouping">
                        <div class="resultsFVText">+1518 (6.2%)</div>
                        <div class="resultsTMJText">6.53%</div>
                        <div class="resultsEVKWText">‚ùå-45.0%</div>
                        <div class="resultsEVKWText">$-14.23</div>
                        <div class="resultsEVKWText">-5.69u</div>
                        <div class="resultsEVKWText">-2.85u</div> 
                        <div class="resultsEVKWText">-1.42u</div>
                    </div>
                </div>

                <p><strong>Multiplicative:</strong><br>Leg#1 (170); Market Juice = 2.2 %; Fair Value = +176 (36.2 %)<br>Leg#2
                    (229); Market Juice = 2.3 %; Fair Value = +237 (29.7 %)<br>Leg#3 (-149); Market Juice = 2.0 %; Fair Value =
                    -142 (58.6 %)<br>Final Odds (+790); Œ£(Market Juice) = 6.53 %; Fair Value = +1484 (6.3 %)<br>Summary; EV% =
                    -43.8 %, Kelly Wager = $-13.86 (Full=-5.54u, 1/2=-2.77, 1/4=-1.39u) ‚ùå</p>
                <p><strong>Additive:</strong><br>Leg#1 (170); Market Juice = 2.2 %; Fair Value = +178 (35.9 %)<br>Leg#2 (229);
                    Market Juice = 2.3 %; Fair Value = +242 (29.2 %)<br>Leg#3 (-149); Market Juice = 2.0 %; Fair Value = -143
                    (58.8 %)<br>Final Odds (+790); Œ£(Market Juice) = 6.53 %; Fair Value = +1518 (6.2 %)<br>Summary; EV% = -45.0
                    %, Kelly Wager = $-14.23 (Full=-5.69u, 1/2=-2.85, 1/4=-1.42u) ‚ùå</p>
                <p><strong>Power:</strong><br>Leg#1 (170); Market Juice = 2.2 %; Fair Value = +179 (35.8 %)<br>Leg#2 (229);
                    Market Juice = 2.3 %; Fair Value = +245 (29.0 %)<br>Leg#3 (-149); Market Juice = 2.0 %; Fair Value = -143
                    (58.9 %)<br>Final Odds (+790); Œ£(Market Juice) = 6.53 %; Fair Value = +1535 (6.1 %)<br>Summary; EV% = -45.6
                    %, Kelly Wager = $-14.42 (Full=-5.77u, 1/2=-2.88, 1/4=-1.44u) ‚ùå</p>
                <p><strong>Shin:</strong><br>Leg#1 (170); Market Juice = 2.2 %; Fair Value = +178 (35.9 %)<br>Leg#2 (229);
                    Market Juice = 2.3 %; Fair Value = +242 (29.2 %)<br>Leg#3 (-149); Market Juice = 2.0 %; Fair Value = -143
                    (58.8 %)<br>Final Odds (+790); Œ£(Market Juice) = 6.53 %; Fair Value = +1518 (6.2 %)<br>Summary; EV% = -45.0
                    %, Kelly Wager = $-14.23 (Full=-5.69u, 1/2=-2.85, 1/4=-1.42u) ‚ùå</p>
            </div>
            <div class="eventContainer" id="061320232">
                <div><input type="text" class="userInput fst-italic form-control form-control-sm bookInput"><input type="text"
                        class="userInput fst-italic form-control form-control-sm boostDescription"><span
                        class="text-body-tertiary">-122/112,143/-155,-104/-104</span></div>
                <div>
                    <div class="fw-bold mx-2">Odds</div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm"><input
                            type="number" class="userInput form-control form-control-sm"></div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm"><input
                            type="number" class="userInput form-control form-control-sm"></div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm"><input
                            type="number" class="userInput form-control form-control-sm"></div>
                    <div class="finalGrouping">
                        <div class="fw-bold">Final</div><input type="number" class="userInput form-control form-control-sm">
                    </div><button class="calculateButton btn btn-primary btn-sm">Calculate</button>
                </div>
                <p><strong>Multiplicative:</strong><br>Leg#1 (-122); Market Juice = 2.1 %; Fair Value = -117 (53.8 %)<br>Leg#2
                    (143); Market Juice = 1.9 %; Fair Value = +148 (40.4 %)<br>Leg#3 (-104); Market Juice = 2.0 %; Fair Value =
                    -100 (50.0 %)<br>Final Odds (+870); Œ£(Market Juice) = 6.02 %; Fair Value = +821 (10.9 %)<br>Summary; EV% =
                    5.4 %, Kelly Wager = $1.54 (Full=0.62u, 1/2=0.31, 1/4=0.15u) ‚úÖ</p>
                <p><strong>Additive:</strong><br>Leg#1 (-122); Market Juice = 2.1 %; Fair Value = -117 (53.9 %)<br>Leg#2 (143);
                    Market Juice = 1.9 %; Fair Value = +149 (40.2 %)<br>Leg#3 (-104); Market Juice = 2.0 %; Fair Value = -100
                    (50.0 %)<br>Final Odds (+870); Œ£(Market Juice) = 6.02 %; Fair Value = +824 (10.8 %)<br>Summary; EV% = 5.0 %,
                    Kelly Wager = $1.45 (Full=0.58u, 1/2=0.29, 1/4=0.14u) ‚úÖ</p>
                <p><strong>Power:</strong><br>Leg#1 (-122); Market Juice = 2.1 %; Fair Value = -117 (53.9 %)<br>Leg#2 (143);
                    Market Juice = 1.9 %; Fair Value = +149 (40.1 %)<br>Leg#3 (-104); Market Juice = 2.0 %; Fair Value = -100
                    (50.0 %)<br>Final Odds (+870); Œ£(Market Juice) = 6.02 %; Fair Value = +825 (10.8 %)<br>Summary; EV% = 4.9 %,
                    Kelly Wager = $1.40 (Full=0.56u, 1/2=0.28, 1/4=0.14u) ‚úÖ</p>
                <p><strong>Shin:</strong><br>Leg#1 (-122); Market Juice = 2.1 %; Fair Value = -117 (53.9 %)<br>Leg#2 (143);
                    Market Juice = 1.9 %; Fair Value = +149 (40.2 %)<br>Leg#3 (-104); Market Juice = 2.0 %; Fair Value = +100
                    (50.0 %)<br>Final Odds (+870); Œ£(Market Juice) = 6.02 %; Fair Value = +824 (10.8 %)<br>Summary; EV% = 5.0 %,
                    Kelly Wager = $1.45 (Full=0.58u, 1/2=0.29, 1/4=0.14u) ‚úÖ</p>
            </div>
            <div class="eventContainer" id="061320233">
                <div><input type="text" class="userInput fst-italic form-control form-control-sm bookInput"><input type="text"
                        class="userInput fst-italic form-control form-control-sm boostDescription"><span
                        class="text-body-tertiary">-108/-101,122/-132,-143/132</span></div>
                <div>
                    <div class="fw-bold mx-2">Odds</div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm"><input
                            type="number" class="userInput form-control form-control-sm"></div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm"><input
                            type="number" class="userInput form-control form-control-sm"></div>
                    <div class="legGrouping"><input type="number" class="userInput form-control form-control-sm"><input
                            type="number" class="userInput form-control form-control-sm"></div>
                    <div class="finalGrouping">
                        <div class="fw-bold">Final</div><input type="number" class="userInput form-control form-control-sm">
                    </div><button class="calculateButton btn btn-primary btn-sm">Calculate</button>
                </div>
                <p><strong>Multiplicative:</strong><br>Leg#1 (-108); Market Juice = 2.2 %; Fair Value = -103 (50.8 %)<br>Leg#2
                    (122); Market Juice = 1.9 %; Fair Value = +126 (44.2 %)<br>Leg#3 (-143); Market Juice = 2.0 %; Fair Value =
                    -137 (57.7 %)<br>Final Odds (+710); Œ£(Market Juice) = 6.06 %; Fair Value = +672 (13.0 %)<br>Summary; EV% =
                    5.0 %, Kelly Wager = $1.76 (Full=0.70u, 1/2=0.35, 1/4=0.18u) ‚úÖ</p>
                <p><strong>Additive:</strong><br>Leg#1 (-108); Market Juice = 2.2 %; Fair Value = -103 (50.8 %)<br>Leg#2 (122);
                    Market Juice = 1.9 %; Fair Value = +127 (44.1 %)<br>Leg#3 (-143); Market Juice = 2.0 %; Fair Value = -137
                    (57.9 %)<br>Final Odds (+710); Œ£(Market Juice) = 6.06 %; Fair Value = +671 (13.0 %)<br>Summary; EV% = 5.0 %,
                    Kelly Wager = $1.77 (Full=0.71u, 1/2=0.35, 1/4=0.18u) ‚úÖ</p>
                <p><strong>Power:</strong><br>Leg#1 (-108); Market Juice = 2.2 %; Fair Value = -103 (50.8 %)<br>Leg#2 (122);
                    Market Juice = 1.9 %; Fair Value = +127 (44.0 %)<br>Leg#3 (-143); Market Juice = 2.0 %; Fair Value = -138
                    (57.9 %)<br>Final Odds (+710); Œ£(Market Juice) = 6.06 %; Fair Value = +671 (13.0 %)<br>Summary; EV% = 5.1 %,
                    Kelly Wager = $1.78 (Full=0.71u, 1/2=0.36, 1/4=0.18u) ‚úÖ</p>
                <p><strong>Shin:</strong><br>Leg#1 (-108); Market Juice = 2.2 %; Fair Value = -103 (50.8 %)<br>Leg#2 (122);
                    Market Juice = 1.9 %; Fair Value = +127 (44.1 %)<br>Leg#3 (-143); Market Juice = 2.0 %; Fair Value = -137
                    (57.9 %)<br>Final Odds (+710); Œ£(Market Juice) = 6.06 %; Fair Value = +671 (13.0 %)<br>Summary; EV% = 5.0 %,
                    Kelly Wager = $1.77 (Full=0.71u, 1/2=0.35, 1/4=0.18u) ‚úÖ</p>
            </div>
        </div>
    -->

    </main>
</body>

</html>